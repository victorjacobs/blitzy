package dev.vjcbs.blitzy.blitzortung

import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test

internal class DecoderKtTest {
    @Test
    fun testLzwDecompress() {
        val input = "{\"time\":16522925393661980Ę,\"latĆ43.72Ę04ĚlonĆ-86.418323ĚalĞ:0ĚpolĆļ\"mdsĆ7558ĚmcgĆ17Ķ\"stĝuņćĚregiĪŁĚsiŏ:[ĀŕaĆ2676ĚĂĄĆ307499łĜĺ37.957977ĨŠ:-78.Ċ8Ÿ9ķĹŐ8ħŔŖtŘŐ2},ŨŖŐ451Űăą:Ŵ91ĎźĝųƋ8Ĳ3ƣěƇƉžıĖƔƑĺ105ŢƗƙćƛƝƖŪćĲƐāƥų0ƩĔ2ĨƭƧƯĲČŋƴīƈƄİĕƎǊĸƼĦǀŗřƽƜƞǇĈ6łűƦƲƨ3œŻųžŹ3ơƆǚƉƋŴ706ǘǡƚǘũƘǦǄǩŐ96ǊǮų1ĠĒǊǴ:ŷĢƢưǑǙĬǜ6ĤĐǠƒ:ŬœȆǂ4ǨǆȋƄƤŲƧĈ4ĔƿěǓŽ.2ƊĵůȜƈđ.8ċȌƻųĉǤȇƚȪũūČƕȏȰēƢȔȶžȹƔȴĩǻȿɁ2ĮƳȃƧ6ƕȧȈɊƟȤ5ƀȮǯ2Ġ4ĵǒĺı.ȁĠďǺĬĖ.Ęē1ȴɠŉȼɤɉǅɋćđœɏĴǬʋɱğ1.ĴŊƢɸǛ4ſ2ĕŶɄȖƽɇǂƪɦǪƊƳʊŬ40ĤʎȖ0ȸƀ3ɷȽƉ5ƌǬʩȂȣƂʟřȩʅɧĈʱʦĳȑƬżʗ8ďƪǳƵĮĢǸƾɿȣŬȅǁɥʾǪȠɫųČƹǘȕĐĢƀıʕʳɴģĖɟȣƩʻŐ0ʢŐ1ȑ˚ƧĒ8˶ƕȕɳĘ4˶ˋǻŶɴĔģʸżʪǆɈćˮ˗ūƀǭǌ˴Įĳƅȵɲ2ɀǲɾ̓əȝġŹ13Ɂʜƪ˔ǥʄȊȤŷȎ̏ǲȌĔ˞ǓơɴĦɢɘƵŒˡɾǣ\"ɠ4̓ʃǃ˯Ȥʌ˳ǸǲĘ̰̚ʐĊʩĲˤ̀Ĳǎč̢Ʋˬ̀̋Ȥč̪ȯǸĔı͈żʴɯĵɩˤėɀ̩Ėʜɭʂ˕̦ȫȤŮɎ̫ŷʩđʫ̱5ƾ˶ȼ̛Ǜġʨ6ʍ̻ȣǸ͕ʡ̟͗̆ʊ͹4Ȳͼ̰ʴĒŉǎ͎ġƨΔ΃ɲȦͭȤ́ɝɢ̈́ɩȱ̯͠ɻ̠ˣʲͦ̒ēțɠċȴ̿·̧Ĳ˶ΡŸǿț˟ʴάŭ˞̶9ʑȲ̢̞ȭ̇ʠȉͯ9Ȳ̈́Ĕɢʺ̔ʏƌƄƸΕİŒɝέ˒ĕΆ̧̊Ď8̓ʊȍƲʛϐ˴ɀȍňƳͽĭʗ΍Œ̺ήϥαψʆĎΠǋ͛ǿēɪϦʰɴʙň˸̶ƋŮƾȀ̢ɰφ˖Ϟʰ̎ϺưƲΤųġθđЃǻĳʘ0ʰ̓ή͕̽ʽϞ5˼̈́Ƃʨϊͷ̖ʨŬ˱͎̖ƢƢ˲Ι˰ł̿Тͯɂϡ̫Ɂĉȍʫǲİ0őǹΩįŭуƾ̟ͪС́ǖțʊƎ΍ЩϦĠǝф˾ȝʐƩŊƊͪхзюĘѐ̫Ǐ0ƎͷįŹʙȁˤƽʭƊ˼ͤд:Ŋ̤̈ϵɧĤъϹǯǏđΏɲʐ͝ơι̶̖Ĵʰ΁̢ŸэΈ΍ȴʊđňĊрϮȟɯȔƵčſŉ̟ȢƼ͔ЋūΞƲґѥıȍϫȶҗɭČˤҜƀвȼɠ̟Λ̥ȖΞƩʉѥ΁νʫĊſϊͶʲƊİƏĐʜʔңҹ͗ɭ΅ѽųȌбɓĺ͹ȸǿŽИ̜ʘĕьѴĠжΜиʆĕ͹˳ʨĴͱѩɀҶư͎͊Œ˱ϙƼӋѡΈȌЏƦʨĠđι̰ƋĊȟЮӅ̖˓ύτΰӣюőҼȯʨŒ̠ҫ̕ƌ˶̵̟˿ʐıȀҴȣė͕ѹǪˈѤԏŵ˃ҁğįƂɒљǛʐŽ΁ŊʜŮҎЍɃӑʝԐɯЪƌҩϠӰ.ĲɩɝӊɣԋӸŽӨőɭεѕ̖ĮģՉӅʐĘĐ΍ʜпӌȩ]ĚdeĜyųſ}"
        val expected = "{\"time\":1652292539366198000,\"lat\":43.720004,\"lon\":-86.418323,\"alt\":0,\"pol\":0,\"mds\":7558,\"mcg\":173,\"status\":1,\"region\":0,\"sig\":[{\"sta\":2676,\"time\":3074990,\"lat\":37.957977,\"lon\":-78.528999,\"alt\":184,\"status\":12},{\"sta\":1451,\"time\":3091250,\"lat\":38.81831,\"lon\":-77.419884,\"alt\":105,\"status\":12},{\"sta\":1189,\"time\":3091612,\"lat\":38.818298,\"lon\":-77.419899,\"alt\":104,\"status\":10},{\"sta\":1660,\"time\":3130933,\"lat\":37.90345,\"lon\":-78.307068,\"alt\":128,\"status\":12},{\"sta\":1969,\"time\":3143369,\"lat\":49.751812,\"lon\":-77.620399,\"alt\":263,\"status\":4},{\"sta\":1977,\"time\":3164615,\"lat\":37.278236,\"lon\":-93.82296,\"alt\":365,\"status\":12},{\"sta\":2294,\"time\":3166519,\"lat\":37.27845,\"lon\":-93.822861,\"alt\":364,\"status\":12},{\"sta\":2595,\"time\":3243423,\"lat\":41.684353,\"lon\":-98.006615,\"alt\":556,\"status\":12},{\"sta\":1933,\"time\":3260326,\"lat\":41.325851,\"lon\":-74.921974,\"alt\":410,\"status\":12},{\"sta\":1781,\"time\":3264020,\"lat\":40.295353,\"lon\":-75.560028,\"alt\":79,\"status\":4},{\"sta\":1653,\"time\":3283140,\"lat\":34.853123,\"lon\":-86.734055,\"alt\":268,\"status\":12},{\"sta\":1203,\"time\":3299888,\"lat\":39.79541,\"lon\":-75.672981,\"alt\":91,\"status\":10},{\"sta\":1114,\"time\":3368884,\"lat\":41.004883,\"lon\":-74.661728,\"alt\":320,\"status\":10},{\"sta\":2950,\"time\":3386837,\"lat\":42.833157,\"lon\":-73.901382,\"alt\":128,\"status\":12},{\"sta\":2499,\"time\":3396618,\"lat\":45.604645,\"lon\":-73.791504,\"alt\":47,\"status\":12},{\"sta\":2603,\"time\":3433007,\"lat\":41.520218,\"lon\":-74.180992,\"alt\":131,\"status\":12},{\"sta\":2929,\"time\":3461417,\"lat\":35.422359,\"lon\":-80.849998,\"alt\":246,\"status\":12},{\"sta\":2764,\"time\":3490293,\"lat\":45.505886,\"lon\":-73.406326,\"alt\":34,\"status\":12},{\"sta\":1320,\"time\":3504466,\"lat\":45.365509,\"lon\":-73.30909,\"alt\":43,\"status\":2},{\"sta\":2864,\"time\":3591648,\"lat\":35.03841,\"lon\":-80.837662,\"alt\":225,\"status\":12},{\"sta\":1888,\"time\":3599702,\"lat\":35.662678,\"lon\":-79.346901,\"alt\":177,\"status\":12},{\"sta\":946,\"time\":3616479,\"lat\":41.577419,\"lon\":-73.473282,\"alt\":219,\"status\":10},{\"sta\":2587,\"time\":3693174,\"lat\":33.869751,\"lon\":-84.447304,\"alt\":274,\"status\":12},{\"sta\":2564,\"time\":3706695,\"lat\":35.621754,\"lon\":-78.760506,\"alt\":123,\"status\":12},{\"sta\":2350,\"time\":3781318,\"lat\":33.702934,\"lon\":-83.920357,\"alt\":247,\"status\":4},{\"sta\":2548,\"time\":3794094,\"lat\":42.402611,\"lon\":-72.515114,\"alt\":110,\"status\":4},{\"sta\":2297,\"time\":3826569,\"lat\":33.401745,\"lon\":-86.670105,\"alt\":213,\"status\":4},{\"sta\":1822,\"time\":3894494,\"lat\":43.411743,\"lon\":-71.915878,\"alt\":245,\"status\":4},{\"sta\":1002,\"time\":3916089,\"lat\":46.902168,\"lon\":-100.784859,\"alt\":588,\"status\":2},{\"sta\":2005,\"time\":3916936,\"lat\":41.614452,\"lon\":-72.323563,\"alt\":199,\"status\":4},{\"sta\":1445,\"time\":3937552,\"lat\":34.462429,\"lon\":-92.955139,\"alt\":131,\"status\":2},{\"sta\":2315,\"time\":3941691,\"lat\":34.462429,\"lon\":-92.955116,\"alt\":133,\"status\":4},{\"sta\":2913,\"time\":3963678,\"lat\":52.99493,\"lon\":-78.499939,\"alt\":51,\"status\":4},{\"sta\":2434,\"time\":3965159,\"lat\":50.270374,\"lon\":-73.921913,\"alt\":430,\"status\":4},{\"sta\":1950,\"time\":4032764,\"lat\":46.813381,\"lon\":-71.573112,\"alt\":151,\"status\":4},{\"sta\":1960,\"time\":4043932,\"lat\":48.526211,\"lon\":-72.268616,\"alt\":175,\"status\":4},{\"sta\":1173,\"time\":4073381,\"lat\":42.588135,\"lon\":-71.41066,\"alt\":80,\"status\":2},{\"sta\":1852,\"time\":4078316,\"lat\":46.795193,\"lon\":-71.376358,\"alt\":76,\"status\":4},{\"sta\":2396,\"time\":4140742,\"lat\":42.541687,\"lon\":-71.185928,\"alt\":54,\"status\":4},{\"sta\":1937,\"time\":4172488,\"lat\":42.867237,\"lon\":-71.003944,\"alt\":69,\"status\":4}],\"delay\":3.9}"

        val result = lzwDecompress(input)

        assertEquals(expected, result)
    }
}
